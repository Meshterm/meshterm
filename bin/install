#!/usr/bin/env bash
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

echo "Setting up meshterm..."
echo "─────────────────────────────────────"

cd "$PROJECT_DIR"

# Create virtual environment if it doesn't exist
if [ ! -d "$PROJECT_DIR/venv" ]; then
    echo "Creating virtual environment..."
    python3 -m venv "$PROJECT_DIR/venv"
else
    echo "Virtual environment already exists"
fi

echo "Installing dependencies..."
"$PROJECT_DIR/venv/bin/python" -m pip install --quiet --upgrade pip
"$PROJECT_DIR/venv/bin/python" -m pip install --quiet -r "$PROJECT_DIR/requirements.txt"

echo "─────────────────────────────────────"
echo "Done! Run with: bin/run [port]"
echo "Example: bin/run /dev/ttyACM0"
